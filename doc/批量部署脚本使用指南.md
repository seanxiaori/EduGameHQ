# EduGameHQ 批量部署脚本使用指南

## 📋 概述

本指南介绍如何使用EduGameHQ的批量部署脚本来自动化部署GitHub上的教育游戏到我们的网站。

## 🚀 脚本介绍

我们提供了两个部署脚本：

### 1. 快速部署脚本 (`quick-deploy.js`)
- **用途**: 快速部署单个游戏
- **特点**: 简单易用，适合测试和单个游戏部署
- **推荐**: 初学者和快速测试使用

### 2. 批量部署脚本 (`batch-deploy-games.js`)
- **用途**: 批量部署多个游戏
- **特点**: 功能完整，支持配置文件，适合大规模部署
- **推荐**: 生产环境和批量操作使用

---

## 🎯 快速部署脚本使用方法

### 基本语法
```bash
node scripts/quick-deploy.js <GitHub仓库URL> <分类>
```

### 支持的分类
- `math` - 数学游戏
- `science` - 科学游戏
- `coding` - 编程游戏
- `language` - 语言游戏
- `puzzle` - 益智游戏
- `sports` - 体育游戏
- `art` - 艺术创意游戏
- `geography` - 历史地理游戏

### 使用示例

#### 部署数学游戏
```bash
node scripts/quick-deploy.js https://github.com/Daviddix/math-game.git math
```

#### 部署益智游戏
```bash
node scripts/quick-deploy.js https://github.com/he-is-talha/html-css-javascript-games.git puzzle
```

#### 部署编程游戏
```bash
node scripts/quick-deploy.js https://github.com/ivancraddock/Web-CodeDefense.git coding
```

### 部署流程
脚本会自动执行以下步骤：

1. **克隆仓库** - 从GitHub下载游戏源码
2. **分析项目** - 读取package.json和README获取游戏信息
3. **构建项目** - 如果需要，自动执行npm install和npm run build
4. **部署文件** - 将游戏文件复制到public/games/目录
5. **创建图片** - 生成游戏预览图片（SVG格式）
6. **更新数据库** - 将游戏信息添加到games.json数据库

### 输出示例
```
[STEP] 开始部署游戏: https://github.com/Daviddix/math-game.git
[STEP] 1/6 克隆仓库...
[SUCCESS] 克隆完成
[STEP] 2/6 分析项目结构...
[INFO] 游戏标题: Math Challenge Game
[INFO] 游戏slug: math-challenge-game
[STEP] 3/6 检查是否需要构建...
[INFO] 发现构建脚本，开始构建...
[SUCCESS] 构建完成
[STEP] 4/6 部署游戏文件...
[SUCCESS] 游戏文件已部署到: C:\Users\Administrator\Desktop\EduGameHQ\public\games\math-challenge-game
[STEP] 5/6 创建预览图片...
[SUCCESS] 预览图片已创建
[STEP] 6/6 更新游戏数据库...
[INFO] 添加新游戏记录
[SUCCESS] 数据库更新完成

🎉 游戏部署成功！
[INFO] 游戏名称: Math Challenge Game
[INFO] 访问地址: http://localhost:3000/games/math-challenge-game
[INFO] 分类页面: http://localhost:3000/math-games
```

---

## 📦 批量部署脚本使用方法

### 1. 创建配置文件

首先创建一个JSON配置文件，例如 `my-games.json`：

```json
{
  "description": "我的游戏部署配置",
  "version": "1.0",
  "games": [
    {
      "repoUrl": "https://github.com/user/game1.git",
      "category": "math",
      "config": {
        "title": "自定义游戏标题",
        "description": "自定义游戏描述",
        "difficulty": "Easy",
        "developer": "开发者名称",
        "tags": ["math", "educational", "fun"],
        "featured": true
      }
    },
    {
      "repoUrl": "https://github.com/user/game2.git",
      "category": "puzzle",
      "config": {
        "difficulty": "Hard",
        "trending": true
      }
    }
  ]
}
```

### 2. 执行批量部署

```bash
node scripts/batch-deploy-games.js --config my-games.json
```

### 3. 单个游戏部署（使用批量脚本）

```bash
node scripts/batch-deploy-games.js --single "https://github.com/user/game.git" --category math
```

### 配置文件字段说明

#### 必需字段
- `repoUrl` - GitHub仓库URL
- `category` - 游戏分类

#### 可选配置字段
- `title` - 自定义游戏标题
- `description` - 自定义游戏描述
- `difficulty` - 难度等级 (Easy/Medium/Hard)
- `developer` - 开发者名称
- `tags` - 标签数组
- `featured` - 是否为特色游戏 (true/false)
- `trending` - 是否为趋势游戏 (true/false)

---

## 🔧 高级功能

### 自动构建支持
脚本支持以下构建工具：
- **npm** - 检测package.json和package-lock.json
- **yarn** - 检测yarn.lock
- **pnpm** - 检测pnpm-lock.yaml

### 构建脚本检测
自动检测以下构建脚本：
- `npm run build`
- `npm run dist`

### 输出目录检测
自动查找以下构建输出目录：
- `dist/`
- `build/`
- `public/`
- `out/`
- `docs/`

### 图片生成
- 自动生成SVG格式的预览图片
- 按分类使用不同的颜色主题
- 创建JPG格式的备用图片

---

## 📁 文件结构

部署完成后的文件结构：

```
EduGameHQ/
├── public/
│   ├── games/
│   │   ├── game-slug-1/          # 游戏1文件
│   │   │   ├── index.html
│   │   │   ├── assets/
│   │   │   └── ...
│   │   └── game-slug-2/          # 游戏2文件
│   └── images/
│       └── games/
│           ├── math/
│           │   ├── game-slug-1.svg
│           │   └── game-slug-1.jpg
│           └── science/
├── src/
│   └── data/
│       └── games.json           # 更新的游戏数据库
└── temp-deploy/                 # 临时目录（自动清理）
```

---

## ⚠️ 注意事项

### 系统要求
- Node.js 14+
- Git 命令行工具
- Windows PowerShell（当前环境）

### 网络要求
- 稳定的网络连接（用于克隆GitHub仓库）
- 能够访问GitHub.com

### 权限要求
- 对项目目录的读写权限
- 能够执行Git命令

### 常见问题

#### 1. 克隆失败
```
[ERROR] 克隆失败: fatal: repository 'https://github.com/user/repo.git' not found
```
**解决方案**: 检查仓库URL是否正确，仓库是否为公开仓库

#### 2. 构建失败
```
[WARNING] 构建失败，使用原始文件
```
**解决方案**: 这是正常情况，脚本会自动使用原始文件

#### 3. 未找到index.html
```
[ERROR] 未找到index.html文件
```
**解决方案**: 确保游戏仓库包含可运行的HTML文件

#### 4. 端口占用
确保3000端口可用，或者游戏部署后在其他端口测试

---

## 🎯 最佳实践

### 1. 游戏选择标准
- ✅ 包含index.html文件
- ✅ 纯HTML5/JavaScript游戏
- ✅ 无需外部API依赖
- ✅ 适合iframe嵌入
- ✅ 有教育价值

### 2. 分类选择
- 根据游戏的主要教育目标选择分类
- 数学游戏优先选择`math`分类
- 编程相关游戏选择`coding`分类
- 通用益智游戏选择`puzzle`分类

### 3. 批量部署建议
- 先用快速脚本测试单个游戏
- 确认游戏可正常运行后再批量部署
- 分批部署，避免一次部署过多游戏

### 4. 质量控制
- 部署后及时测试游戏功能
- 检查游戏是否适合目标年龄段
- 确认游戏的教育价值

---

## 📊 部署统计

使用批量脚本部署后，会显示详细的部署统计：

```
=== 部署摘要 ===
✅ 成功部署: 3 个游戏

成功部署的游戏:
  - Math Challenge Game (math-challenge-game) - Math
  - Code Defense (code-defense) - Programming
  - HTML5 Games Collection (html5-games-collection) - Puzzle

❌ 部署失败: 1 个游戏

失败的游戏:
  - https://github.com/user/broken-repo.git: 未找到index.html文件
```

---

## 🔄 后续操作

### 部署完成后
1. **测试游戏** - 访问游戏页面确认正常运行
2. **检查分类页** - 确认游戏出现在正确的分类页面
3. **提交代码** - 使用Git提交新增的游戏文件和数据

### Git提交
```bash
git add .
git commit -m "feat: 批量部署新游戏 - 添加X款教育游戏"
git push origin master
```

### 网站更新
部署完成后，Astro开发服务器会自动检测文件变化并更新网站。

---

## 🆘 获取帮助

### 查看脚本帮助
```bash
node scripts/quick-deploy.js
node scripts/batch-deploy-games.js --help
```

### 常用命令
```bash
# 查看当前游戏数量
node -e "console.log(JSON.parse(require('fs').readFileSync('src/data/games.json')).length + ' games')"

# 按分类统计游戏
node -e "const games = JSON.parse(require('fs').readFileSync('src/data/games.json')); const stats = {}; games.forEach(g => stats[g.category] = (stats[g.category] || 0) + 1); console.log(stats);"
```

---

## 📝 更新日志

### v1.0 (当前版本)
- ✅ 支持GitHub仓库自动克隆
- ✅ 自动检测和执行构建脚本
- ✅ 自动生成游戏预览图片
- ✅ 自动更新games.json数据库
- ✅ 支持批量部署和单个部署
- ✅ 完整的错误处理和日志输出

### 计划功能
- 🔄 支持更多构建工具
- 🔄 自动截图功能
- 🔄 游戏质量评估
- 🔄 自动化测试集成

---

通过这个批量部署脚本，你可以快速地将GitHub上的优质教育游戏部署到EduGameHQ平台，大大提高游戏库的建设效率！ 