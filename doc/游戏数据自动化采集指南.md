# EduGameHQæ¸¸æˆæ•°æ®è‡ªåŠ¨åŒ–é‡‡é›†æŒ‡å— v1.0

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä¸ºEduGameHQå¹³å°è‡ªåŠ¨åŒ–é‡‡é›†æ¸¸æˆæ•°æ®ï¼ŒåŒ…æ‹¬æ¸¸æˆä¿¡æ¯ã€æˆªå›¾ã€å…ƒæ•°æ®ç­‰ï¼Œä»¥æé«˜æ•°æ®å½•å…¥æ•ˆç‡å¹¶ç¡®ä¿æ•°æ®è´¨é‡çš„ä¸€è‡´æ€§ã€‚

### ğŸ¯ ç›®æ ‡
- è‡ªåŠ¨åŒ–è·å–æ¸¸æˆåŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ã€å¼€å‘è€…ç­‰ï¼‰
- è‡ªåŠ¨ç”Ÿæˆæˆ–ä¸‹è½½é«˜è´¨é‡æ¸¸æˆæˆªå›¾
- æ™ºèƒ½ç”Ÿæˆæ¸¸æˆæ ‡ç­¾å’Œåˆ†ç±»ä¿¡æ¯
- æ‰¹é‡å¤„ç†å¤§é‡æ¸¸æˆæ•°æ®
- é¿å…æ–‡ä»¶å†—ä½™ï¼Œä¼˜åŒ–å­˜å‚¨ç»“æ„

---

## ğŸ” å½“å‰æ•°æ®ç»“æ„åˆ†æ

### ç°æœ‰æ•°æ®åº“å­—æ®µ
åŸºäº `doc/æ•°æ®åº“å­—æ®µè®¾è®¡æ–‡æ¡£.md` çš„æœ€æ–°è®¾è®¡ï¼š

#### ğŸ”µ æ ¸å¿ƒå­—æ®µï¼ˆå¿…éœ€ï¼‰
- `slug` - æ¸¸æˆå”¯ä¸€æ ‡è¯†ç¬¦
- `title` - æ¸¸æˆåç§°
- `category` - æ¸¸æˆåˆ†ç±»ï¼ˆç³»ç»Ÿæ ‡è¯†ï¼‰
- `categoryName` - åˆ†ç±»æ˜¾ç¤ºåç§°
- `url` - æ¸¸æˆiframeåœ°å€
- `description` - æ¸¸æˆæè¿°

#### ğŸŸ¢ æ˜¾ç¤ºå­—æ®µï¼ˆå¿…éœ€ï¼‰
- `image` - æ¸¸æˆæˆªå›¾/å°é¢å›¾ç‰‡
- `imageFallback` - å¤‡ç”¨å›¾ç‰‡æ ¼å¼
- `difficulty` - æ¸¸æˆéš¾æ˜“åº¦
- `ageRange` - é€‚åˆå¹´é¾„èŒƒå›´
- `minAge` - æœ€å°é€‚åˆå¹´é¾„
- `maxAge` - æœ€å¤§é€‚åˆå¹´é¾„
- `tags` - æ¸¸æˆæ ‡ç­¾æ•°ç»„

#### ğŸŸ¡ çŠ¶æ€å­—æ®µï¼ˆå¯é€‰ï¼‰
- `playCount` - æ¸¸æˆäººæ°”å€¼
- `featured` - æ˜¯å¦ç‰¹è‰²æ¸¸æˆ
- `trending` - æ˜¯å¦è¶‹åŠ¿æ¸¸æˆ
- `isNew` - æ˜¯å¦æ–°æ¸¸æˆ

#### ğŸ”´ å¼€å‘è€…å­—æ®µï¼ˆå¿…éœ€ï¼‰
- `developer` - å¼€å‘è€…åç§°
- `source` - æ¸¸æˆæ¥æºå¹³å°
- `type` - å•†ä¸šç±»å‹

---

## ğŸ¤– è‡ªåŠ¨åŒ–é‡‡é›†ç­–ç•¥

### å­—æ®µè·å–éš¾åº¦åˆ†æ

| å­—æ®µç±»å‹ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | è·å–æ–¹å¼ | å®ç°éš¾åº¦ |
|----------|------------|----------|----------|
| **âœ… å®Œå…¨è‡ªåŠ¨** | 90%+ | ç›´æ¥çˆ¬å– | ğŸŸ¢ ç®€å• |
| **âš ï¸ åŠè‡ªåŠ¨** | 50-90% | çˆ¬å–+AIè¾…åŠ© | ğŸŸ¡ ä¸­ç­‰ |
| **âŒ æ‰‹åŠ¨è¯„ä¼°** | <50% | äººå·¥åˆ¤æ–­ | ğŸ”´ å›°éš¾ |

#### âœ… å®Œå…¨è‡ªåŠ¨è·å–å­—æ®µ
```javascript
const autoFields = {
  title: "é¡µé¢<title>æ ‡ç­¾æˆ–H1æ ‡ç­¾æå–",
  url: "ç”¨æˆ·æä¾›çš„iframeåœ°å€",
  slug: "æ ¹æ®titleè‡ªåŠ¨ç”ŸæˆURLå‹å¥½æ ¼å¼",
  source: "æ ¹æ®URLåŸŸåè‡ªåŠ¨è¯†åˆ«å¹³å°",
  developer: "é¡µé¢å¼€å‘è€…ä¿¡æ¯æå–",
  type: "é»˜è®¤è®¾ä¸º'Free'",
  playCount: "å¹³å°æ•°æ®æå–æˆ–éšæœºç”Ÿæˆ"
};
```

#### âš ï¸ åŠè‡ªåŠ¨è·å–å­—æ®µ
```javascript
const semiAutoFields = {
  description: "é¡µé¢metaæè¿° + AIä¼˜åŒ–æ¶¦è‰²",
  image: "è‡ªåŠ¨æˆªå›¾ + å®˜æ–¹å›¾ç‰‡ä¸‹è½½",
  imageFallback: "è‡ªåŠ¨ç”ŸæˆJPGå¤‡ç”¨æ ¼å¼",
  tags: "åŸºäºåˆ†ç±»çš„é¢„è®¾æ ‡ç­¾ + AIå†…å®¹åˆ†æ"
};
```

#### âŒ æ‰‹åŠ¨è¯„ä¼°å­—æ®µ
```javascript
const manualFields = {
  category: "éœ€è¦ç†è§£æ¸¸æˆå†…å®¹è¿›è¡Œåˆ†ç±»",
  categoryName: "åŸºäºcategoryè‡ªåŠ¨æ˜ å°„",
  difficulty: "éœ€è¦è¯•ç©è¯„ä¼°æ¸¸æˆéš¾åº¦",
  ageRange: "éœ€è¦æ•™è‚²ä¸“ä¸šçŸ¥è¯†åˆ¤æ–­",
  minAge: "åŸºäºageRangeè‡ªåŠ¨è®¡ç®—",
  maxAge: "åŸºäºageRangeè‡ªåŠ¨è®¡ç®—",
  featured: "ç¼–è¾‘ç­–ç•¥å†³å®š",
  trending: "åŸºäºæ•°æ®åˆ†æå†³å®š",
  isNew: "åŸºäºæ·»åŠ æ—¶é—´è‡ªåŠ¨è®¾ç½®"
};
```

---

## ğŸ–¼ï¸ æ¸¸æˆæˆªå›¾è‡ªåŠ¨åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ™ºèƒ½æˆªå›¾ç³»ç»Ÿï¼ˆæ¨èï¼‰

**æŠ€æœ¯æ ˆ**: Puppeteer + Sharpå›¾ç‰‡å¤„ç†

**æˆªå›¾ç­–ç•¥**:
1. **æ™ºèƒ½ç­‰å¾…** - ç­‰å¾…æ¸¸æˆå®Œå…¨åŠ è½½ï¼ˆ5-8ç§’ï¼‰
2. **äº¤äº’æ¨¡æ‹Ÿ** - è‡ªåŠ¨ç‚¹å‡»å¼€å§‹æŒ‰é’®ã€è·³è¿‡ä»‹ç»
3. **å¤šçŠ¶æ€æˆªå›¾** - åŠ è½½é¡µé¢ã€æ¸¸æˆç•Œé¢ã€æ“ä½œç•Œé¢
4. **å›¾ç‰‡ä¼˜åŒ–** - ç»Ÿä¸€å°ºå¯¸ã€æ ¼å¼è½¬æ¢ã€è´¨é‡å‹ç¼©

```javascript
// æ ¸å¿ƒæˆªå›¾é€»è¾‘
async function captureGameScreenshot(gameUrl, gameSlug, category) {
  const page = await browser.newPage();
  
  // è®¾ç½®è§†çª—å¤§å°
  await page.setViewport({ width: 800, height: 600 });
  
  try {
    // è®¿é—®æ¸¸æˆé¡µé¢
    await page.goto(gameUrl, { 
      waitUntil: 'networkidle0',
      timeout: 30000 
    });
    
    // ç­‰å¾…æ¸¸æˆåŠ è½½
    await page.waitForTimeout(8000);
    
    // å°è¯•ç‚¹å‡»å¼€å§‹æŒ‰é’®
    const playButtons = [
      '.play-button', '.start-button', '.begin-button',
      '[class*="play"]', '[class*="start"]', 
      'button:contains("Play")', 'button:contains("Start")'
    ];
    
    for (const selector of playButtons) {
      try {
        await page.click(selector, { timeout: 2000 });
        await page.waitForTimeout(3000);
        console.log(`âœ… æˆåŠŸç‚¹å‡»å¼€å§‹æŒ‰é’®: ${selector}`);
        break;
      } catch (e) {
        // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªé€‰æ‹©å™¨
      }
    }
    
    // å°è¯•è·³è¿‡ä»‹ç»æˆ–æ•™ç¨‹
    const skipButtons = [
      '.skip-button', '.skip-intro', '.next-button',
      '[class*="skip"]', 'button:contains("Skip")'
    ];
    
    for (const selector of skipButtons) {
      try {
        await page.click(selector, { timeout: 1000 });
        await page.waitForTimeout(2000);
        break;
      } catch (e) {
        // ç»§ç»­
      }
    }
    
    // æˆªå›¾ä¿å­˜è·¯å¾„
    const imagePath = `public/images/games/${category}/${gameSlug}`;
    
    // æˆªå›¾å¹¶ä¿å­˜ä¸ºWebPæ ¼å¼
    await page.screenshot({
      path: `${imagePath}.webp`,
      type: 'webp',
      quality: 80,
      clip: { x: 0, y: 0, width: 800, height: 600 }
    });
    
    // ç”ŸæˆJPGå¤‡ç”¨æ ¼å¼
    await page.screenshot({
      path: `${imagePath}.jpg`,
      type: 'jpeg', 
      quality: 85,
      clip: { x: 0, y: 0, width: 800, height: 600 }
    });
    
    console.log(`ğŸ“¸ æˆªå›¾å®Œæˆ: ${gameSlug}`);
    
    return {
      image: `/images/games/${category}/${gameSlug}.webp`,
      imageFallback: `/images/games/${category}/${gameSlug}.jpg`
    };
    
  } catch (error) {
    console.error(`âŒ æˆªå›¾å¤±è´¥: ${gameSlug} - ${error.message}`);
    
    // ä½¿ç”¨é»˜è®¤å›¾ç‰‡
    return {
      image: `/images/games/default.webp`,
      imageFallback: `/images/games/default.jpg`
    };
  } finally {
    await page.close();
  }
}
```

### æ–¹æ¡ˆ2: å®˜æ–¹å›¾ç‰‡ä¸‹è½½

**ä¼˜å…ˆçº§**: å¦‚æœæ¸¸æˆé¡µé¢æœ‰å®˜æ–¹æˆªå›¾ï¼Œä¼˜å…ˆä¸‹è½½

```javascript
// å®˜æ–¹å›¾ç‰‡ä¸‹è½½é€»è¾‘
async function downloadOfficialImage(gamePageUrl, gameSlug, category) {
  try {
    const response = await fetch(gamePageUrl);
    const html = await response.text();
    
    // æŸ¥æ‰¾å®˜æ–¹å›¾ç‰‡çš„å¤šç§å¯èƒ½ä½ç½®
    const imageSelectors = [
      'meta[property="og:image"]',
      'meta[name="twitter:image"]',
      '.game-screenshot img',
      '.game-thumbnail img',
      '.game-preview img',
      '.game-image img',
      '.screenshot img'
    ];
    
    for (const selector of imageSelectors) {
      const imageUrl = extractImageFromHTML(html, selector);
      if (imageUrl && isValidImageUrl(imageUrl)) {
        const success = await downloadAndOptimizeImage(
          imageUrl, 
          gameSlug, 
          category
        );
        if (success) {
          console.log(`âœ… å®˜æ–¹å›¾ç‰‡ä¸‹è½½æˆåŠŸ: ${gameSlug}`);
          return {
            image: `/images/games/${category}/${gameSlug}.webp`,
            imageFallback: `/images/games/${category}/${gameSlug}.jpg`
          };
        }
      }
    }
    
    console.log(`âš ï¸ æœªæ‰¾åˆ°å®˜æ–¹å›¾ç‰‡: ${gameSlug}`);
    return null;
    
  } catch (error) {
    console.error(`âŒ å®˜æ–¹å›¾ç‰‡ä¸‹è½½å¤±è´¥: ${gameSlug} - ${error.message}`);
    return null;
  }
}

// ä¸‹è½½å¹¶ä¼˜åŒ–å›¾ç‰‡
async function downloadAndOptimizeImage(imageUrl, gameSlug, category) {
  try {
    const response = await axios.get(imageUrl, {
      responseType: 'arraybuffer',
      timeout: 10000,
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
      }
    });
    
    const imageBuffer = Buffer.from(response.data);
    const imagePath = `public/images/games/${category}/${gameSlug}`;
    
    // ä½¿ç”¨Sharpå¤„ç†å›¾ç‰‡
    await sharp(imageBuffer)
      .resize(400, 300, { 
        fit: 'cover',
        position: 'center'
      })
      .webp({ quality: 80 })
      .toFile(`${imagePath}.webp`);
    
    await sharp(imageBuffer)
      .resize(400, 300, { 
        fit: 'cover',
        position: 'center'
      })
      .jpeg({ quality: 85 })
      .toFile(`${imagePath}.jpg`);
    
    return true;
  } catch (error) {
    console.error(`å›¾ç‰‡å¤„ç†å¤±è´¥: ${error.message}`);
    return false;
  }
}
```

---

## ğŸ› ï¸ è‡ªåŠ¨åŒ–å·¥å…·æ¶æ„

### ä¸»è¦ç±»è®¾è®¡

```javascript
class GameDataScraper {
  constructor() {
    this.browser = null;
    this.outputDir = './src/data';
    this.imageDir = './public/images/games';
    
    // æ”¯æŒçš„æ¸¸æˆå¹³å°
    this.platforms = {
      'crazygames.com': this.scrapeCrazyGames.bind(this),
      'miniplay.com': this.scrapeMiniplay.bind(this),
      'gamedistribution.com': this.scrapeGameDistribution.bind(this),
      'scratch.mit.edu': this.scrapeScratch.bind(this)
    };
    
    // åˆ†ç±»æ˜ å°„
    this.categoryNames = {
      'math': 'Math',
      'science': 'Science',
      'coding': 'Programming',
      'language': 'Language Arts',
      'puzzle': 'Puzzle',
      'sports': 'Sports',
      'art': 'Art & Creativity',
      'geography': 'Geography & History'
    };
  }
  
  // åˆå§‹åŒ–æµè§ˆå™¨å’Œç›®å½•
  async init() {
    console.log('ğŸš€ å¯åŠ¨æ¸¸æˆæ•°æ®é‡‡é›†å·¥å…·...');
    
    this.browser = await puppeteer.launch({ 
      headless: false, // å¯è§†åŒ–æ¨¡å¼ï¼Œä¾¿äºè°ƒè¯•
      defaultViewport: { width: 1200, height: 800 },
      args: ['--no-sandbox', '--disable-setuid-sandbox']
    });
    
    // ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
    await this.ensureDirectories();
  }
  
  // ç¡®ä¿æ‰€æœ‰å¿…è¦ç›®å½•å­˜åœ¨
  async ensureDirectories() {
    const dirs = [
      this.outputDir,
      this.imageDir,
      `${this.imageDir}/math`,
      `${this.imageDir}/science`,
      `${this.imageDir}/coding`,
      `${this.imageDir}/language`,
      `${this.imageDir}/puzzle`,
      `${this.imageDir}/sports`,
      `${this.imageDir}/art`,
      `${this.imageDir}/geography`
    ];

    for (const dir of dirs) {
      try {
        await fs.mkdir(dir, { recursive: true });
      } catch (error) {
        // ç›®å½•å·²å­˜åœ¨ï¼Œå¿½ç•¥é”™è¯¯
      }
    }
  }
  
  // ä¸»è¦é‡‡é›†æ–¹æ³•
  async scrapeGame(gameUrl, category = 'math') {
    console.log(`ğŸ“¥ å¼€å§‹é‡‡é›†æ¸¸æˆ: ${gameUrl}`);
    
    try {
      // è¯†åˆ«æ¸¸æˆå¹³å°
      const platform = this.identifyPlatform(gameUrl);
      if (!platform) {
        throw new Error('ä¸æ”¯æŒçš„æ¸¸æˆå¹³å°');
      }

      // è°ƒç”¨å¯¹åº”å¹³å°çš„é‡‡é›†å‡½æ•°
      const gameData = await this.platforms[platform](gameUrl, category);
      
      // ç”Ÿæˆæˆªå›¾
      const imageData = await this.captureScreenshot(gameData);
      Object.assign(gameData, imageData);
      
      // AIè¾…åŠ©ä¼˜åŒ–æ•°æ®
      await this.enhanceWithAI(gameData);
      
      console.log(`âœ… æ¸¸æˆé‡‡é›†å®Œæˆ: ${gameData.title}`);
      return gameData;
      
    } catch (error) {
      console.error(`âŒ é‡‡é›†å¤±è´¥: ${error.message}`);
      throw error;
    }
  }
  
  // è¯†åˆ«æ¸¸æˆå¹³å°
  identifyPlatform(url) {
    for (const platform of Object.keys(this.platforms)) {
      if (url.includes(platform)) {
        return platform;
      }
    }
    return null;
  }
  
  // æ„å»ºå®Œæ•´çš„æ¸¸æˆæ•°æ®å¯¹è±¡
  buildGameData(scrapedData, gameUrl, category) {
    const slug = this.generateSlug(scrapedData.title);
    
    return {
      slug,
      title: scrapedData.title,
      category,
      categoryName: this.categoryNames[category] || 'Educational',
      url: gameUrl,
      description: scrapedData.description,
      difficulty: 'Medium', // é»˜è®¤å€¼ï¼Œåç»­å¯æ‰‹åŠ¨è°ƒæ•´
      ageRange: this.getDefaultAgeRange(category),
      minAge: this.getDefaultMinAge(category),
      maxAge: this.getDefaultMaxAge(category),
      image: '', // å°†åœ¨æˆªå›¾åå¡«å……
      imageFallback: '', // å°†åœ¨æˆªå›¾åå¡«å……
      playCount: scrapedData.playCount || Math.floor(Math.random() * 10000) + 1000,
      tags: this.generateTags(category, scrapedData.title),
      featured: false,
      trending: false,
      isNew: true,
      developer: scrapedData.developer,
      source: scrapedData.source,
      type: 'Free'
    };
  }
  
  // ç”ŸæˆURLå‹å¥½çš„slug
  generateSlug(title) {
    return title
      .toLowerCase()
      .replace(/[^a-z0-9\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-')
      .trim('-');
  }
  
  // æ ¹æ®åˆ†ç±»è·å–é»˜è®¤å¹´é¾„èŒƒå›´
  getDefaultAgeRange(category) {
    const ageRanges = {
      'math': '6-14',
      'science': '8-16',
      'coding': '10-18',
      'language': '6-16',
      'puzzle': '8-16',
      'sports': '6-18',
      'art': '6-16',
      'geography': '10-18'
    };
    return ageRanges[category] || '8-14';
  }
  
  // æ ¹æ®åˆ†ç±»è·å–é»˜è®¤æœ€å°å¹´é¾„
  getDefaultMinAge(category) {
    const ageRange = this.getDefaultAgeRange(category);
    return parseInt(ageRange.split('-')[0]);
  }
  
  // æ ¹æ®åˆ†ç±»è·å–é»˜è®¤æœ€å¤§å¹´é¾„
  getDefaultMaxAge(category) {
    const ageRange = this.getDefaultAgeRange(category);
    return parseInt(ageRange.split('-')[1]);
  }
  
  // ç”ŸæˆåŸºç¡€æ ‡ç­¾
  generateTags(category, title) {
    const baseTags = ['educational', 'free', 'online'];
    const categoryTags = {
      'math': ['math', 'numbers', 'calculation', 'arithmetic'],
      'science': ['science', 'experiment', 'discovery', 'STEM'],
      'coding': ['programming', 'coding', 'logic', 'computer'],
      'language': ['language', 'vocabulary', 'reading', 'writing'],
      'puzzle': ['puzzle', 'brain', 'logic', 'thinking'],
      'sports': ['sports', 'physical', 'competition', 'fitness'],
      'art': ['art', 'creativity', 'design', 'drawing'],
      'geography': ['geography', 'history', 'world', 'culture']
    };
    
    const tags = [...baseTags, ...(categoryTags[category] || [])];
    
    // æ ¹æ®æ ‡é¢˜æ·»åŠ ç‰¹å®šæ ‡ç­¾
    const titleLower = title.toLowerCase();
    if (titleLower.includes('2048')) tags.push('2048', 'merge');
    if (titleLower.includes('duck')) tags.push('animals', 'duck');
    if (titleLower.includes('typing')) tags.push('typing', 'keyboard');
    if (titleLower.includes('memory')) tags.push('memory', 'brain-training');
    
    return [...new Set(tags)]; // å»é‡
  }
  
  // æ‰¹é‡å¤„ç†æ¸¸æˆåˆ—è¡¨
  async batchScrape(gameList) {
    console.log(`ğŸ”„ å¼€å§‹æ‰¹é‡å¤„ç† ${gameList.length} ä¸ªæ¸¸æˆ...`);
    
    const results = [];
    const errors = [];
    
    for (let i = 0; i < gameList.length; i++) {
      const { url, category, title } = gameList[i];
      console.log(`\nğŸ“¥ å¤„ç†ç¬¬ ${i + 1}/${gameList.length} ä¸ªæ¸¸æˆ: ${title || url}`);
      
      try {
        const gameData = await this.scrapeGame(url, category);
        results.push(gameData);
        
        // ä¿å­˜å•ä¸ªæ¸¸æˆæ•°æ®
        await this.saveGameData(gameData);
        
        // é¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
        await this.delay(3000);
        
      } catch (error) {
        errors.push({ url, title, error: error.message });
        console.error(`âŒ å¤„ç†å¤±è´¥: ${title || url}`);
      }
    }
    
    // ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
    await this.generateReport(results, errors);
    
    console.log(`\nâœ… æ‰¹é‡å¤„ç†å®Œæˆ!`);
    console.log(`æˆåŠŸ: ${results.length} ä¸ª`);
    console.log(`å¤±è´¥: ${errors.length} ä¸ª`);
    
    return { results, errors };
  }
  
  // ä¿å­˜æ¸¸æˆæ•°æ®åˆ°JSONæ–‡ä»¶
  async saveGameData(gameData) {
    const filePath = `${this.outputDir}/games.json`;
    
    try {
      // è¯»å–ç°æœ‰æ•°æ®
      let existingData = [];
      try {
        const fileContent = await fs.readFile(filePath, 'utf8');
        existingData = JSON.parse(fileContent);
      } catch (e) {
        // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨ç©ºæ•°ç»„
      }
      
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      const existingIndex = existingData.findIndex(game => game.slug === gameData.slug);
      
      if (existingIndex >= 0) {
        // æ›´æ–°ç°æœ‰æ¸¸æˆ
        existingData[existingIndex] = gameData;
        console.log(`ğŸ”„ æ›´æ–°æ¸¸æˆæ•°æ®: ${gameData.title}`);
      } else {
        // æ·»åŠ æ–°æ¸¸æˆ
        existingData.push(gameData);
        console.log(`â• æ·»åŠ æ–°æ¸¸æˆ: ${gameData.title}`);
      }
      
      // ä¿å­˜æ–‡ä»¶
      await fs.writeFile(filePath, JSON.stringify(existingData, null, 2));
      
    } catch (error) {
      console.error(`âŒ ä¿å­˜æ¸¸æˆæ•°æ®å¤±è´¥: ${error.message}`);
    }
  }
  
  // å»¶è¿Ÿå‡½æ•°
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
  
  // æ¸…ç†èµ„æº
  async cleanup() {
    if (this.browser) {
      await this.browser.close();
    }
    console.log('ğŸ§¹ èµ„æºæ¸…ç†å®Œæˆ');
  }
}
```

### å¹³å°ç‰¹å®šé€‚é…å™¨

#### CrazyGamesé€‚é…å™¨
```javascript
async scrapeCrazyGames(gameUrl, category) {
  const page = await this.browser.newPage();
  await page.goto(gameUrl, { waitUntil: 'networkidle0' });
  
  const gameData = await page.evaluate(() => {
    // è·å–æ¸¸æˆæ ‡é¢˜
    const title = document.querySelector('h1')?.textContent?.trim() || 
                 document.title.split(' - ')[0];
    
    // è·å–æ¸¸æˆæè¿°
    const description = document.querySelector('meta[name="description"]')?.content ||
                       document.querySelector('.game-description')?.textContent?.trim() ||
                       `Play ${title} online for free. Educational game perfect for learning.`;
    
    // è·å–å¼€å‘è€…ä¿¡æ¯
    const developer = document.querySelector('.developer-name')?.textContent?.trim() ||
                     document.querySelector('.game-author')?.textContent?.trim() ||
                     'CrazyGames';
    
    // è·å–æ’­æ”¾æ¬¡æ•°ï¼ˆå¦‚æœæœ‰ï¼‰
    const playCountText = document.querySelector('.play-count')?.textContent;
    let playCount = 0;
    if (playCountText) {
      const match = playCountText.match(/[\d,]+/);
      if (match) {
        playCount = parseInt(match[0].replace(/,/g, ''));
      }
    }
    
    return {
      title,
      description,
      developer,
      playCount,
      source: 'CrazyGames'
    };
  });
  
  await page.close();
  return this.buildGameData(gameData, gameUrl, category);
}
```

#### Miniplayé€‚é…å™¨
```javascript
async scrapeMiniplay(gameUrl, category) {
  const page = await this.browser.newPage();
  await page.goto(gameUrl, { waitUntil: 'networkidle0' });
  
  const gameData = await page.evaluate(() => {
    const title = document.querySelector('.game-title')?.textContent?.trim() ||
                 document.querySelector('h1')?.textContent?.trim() ||
                 document.title.split(' - ')[0];
    
    const description = document.querySelector('.game-description')?.textContent?.trim() ||
                       document.querySelector('meta[name="description"]')?.content ||
                       `Play ${title} online. Fun educational game for kids.`;
    
    const developer = document.querySelector('.game-developer')?.textContent?.trim() ||
                     'Miniplay';
    
    return {
      title,
      description,
      developer,
      playCount: 0,
      source: 'Miniplay'
    };
  });
  
  await page.close();
  return this.buildGameData(gameData, gameUrl, category);
}
```

---

## ğŸ“ æ–‡ä»¶æ¸…ç†å’Œé‡ç»„ç­–ç•¥

### å½“å‰é—®é¢˜åˆ†æ
1. **æ–‡ä»¶å†—ä½™** - å­˜åœ¨å¤§é‡SVGå ä½ç¬¦å’Œç©ºçš„JPGæ–‡ä»¶
2. **ç»“æ„æ··ä¹±** - å›¾ç‰‡æ–‡ä»¶æ²¡æœ‰æŒ‰åˆ†ç±»ç»„ç»‡
3. **æ•°æ®ä¸ä¸€è‡´** - å­˜åœ¨è¿‡æ—¶çš„å­—æ®µå’Œæ ¼å¼

### æ¸…ç†æ­¥éª¤

#### ç¬¬ä¸€æ­¥: æ•°æ®å¤‡ä»½
```bash
# å¤‡ä»½ç°æœ‰æ•°æ®
cp src/data/games.json src/data/games-backup-$(date +%Y%m%d).json

# å¤‡ä»½å›¾ç‰‡ç›®å½•
cp -r public/images/games public/images/games-backup-$(date +%Y%m%d)
```

#### ç¬¬äºŒæ­¥: æ¸…ç†æ— ç”¨æ–‡ä»¶
```bash
# åˆ é™¤SVGå ä½ç¬¦
find public/images/games/ -name "*.svg" -delete

# åˆ é™¤å°äº1KBçš„ç©ºJPGæ–‡ä»¶
find public/images/games/ -name "*.jpg" -size -1k -delete

# åˆ é™¤å°äº1KBçš„ç©ºWebPæ–‡ä»¶
find public/images/games/ -name "*.webp" -size -1k -delete
```

#### ç¬¬ä¸‰æ­¥: é‡ç»„ç›®å½•ç»“æ„
```javascript
// æŒ‰åˆ†ç±»é‡ç»„å›¾ç‰‡æ–‡ä»¶
async function reorganizeImageFiles() {
  const gamesData = JSON.parse(await fs.readFile('src/data/games.json', 'utf8'));
  
  for (const game of gamesData) {
    const oldImagePath = `public/images/games/${game.slug}`;
    const newImagePath = `public/images/games/${game.category}/${game.slug}`;
    
    // ç§»åŠ¨WebPæ–‡ä»¶
    if (await fileExists(`${oldImagePath}.webp`)) {
      await fs.rename(`${oldImagePath}.webp`, `${newImagePath}.webp`);
    }
    
    // ç§»åŠ¨JPGæ–‡ä»¶
    if (await fileExists(`${oldImagePath}.jpg`)) {
      await fs.rename(`${oldImagePath}.jpg`, `${newImagePath}.jpg`);
    }
    
    // æ›´æ–°æ¸¸æˆæ•°æ®ä¸­çš„å›¾ç‰‡è·¯å¾„
    game.image = `/images/games/${game.category}/${game.slug}.webp`;
    game.imageFallback = `/images/games/${game.category}/${game.slug}.jpg`;
  }
  
  // ä¿å­˜æ›´æ–°åçš„æ•°æ®
  await fs.writeFile('src/data/games.json', JSON.stringify(gamesData, null, 2));
}
```

#### ç¬¬å››æ­¥: æ•°æ®ç»“æ„æ›´æ–°
```javascript
// æ›´æ–°æ•°æ®ç»“æ„ï¼Œç§»é™¤æ—§å­—æ®µï¼Œæ·»åŠ æ–°å­—æ®µ
function updateGameDataStructure(gameData) {
  // ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ
  delete gameData.rating;
  delete gameData.learningObjectives;
  delete gameData.gameFeatures;
  
  // æ·»åŠ å¹´é¾„å­—æ®µï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  if (!gameData.ageRange) {
    const defaultAges = {
      'math': { ageRange: '6-14', minAge: 6, maxAge: 14 },
      'science': { ageRange: '8-16', minAge: 8, maxAge: 16 },
      'coding': { ageRange: '10-18', minAge: 10, maxAge: 18 },
      'language': { ageRange: '6-16', minAge: 6, maxAge: 16 },
      'puzzle': { ageRange: '8-16', minAge: 8, maxAge: 16 },
      'sports': { ageRange: '6-18', minAge: 6, maxAge: 18 },
      'art': { ageRange: '6-16', minAge: 6, maxAge: 16 },
      'geography': { ageRange: '10-18', minAge: 10, maxAge: 18 }
    };
    
    const ages = defaultAges[gameData.category] || { ageRange: '8-14', minAge: 8, maxAge: 14 };
    Object.assign(gameData, ages);
  }
  
  // ç¡®ä¿å¿…éœ€å­—æ®µå­˜åœ¨
  if (!gameData.difficulty) gameData.difficulty = 'Medium';
  if (!gameData.type) gameData.type = 'Free';
  if (!gameData.tags) gameData.tags = ['educational', 'free', 'online'];
  
  return gameData;
}
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: ç¯å¢ƒå‡†å¤‡ï¼ˆåŠå¤©ï¼‰

#### å®‰è£…ä¾èµ–
```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
npm install puppeteer sharp axios cheerio

# å®‰è£…å¼€å‘ä¾èµ–
npm install --save-dev @types/node
```

#### åˆ›å»ºç›®å½•ç»“æ„
```bash
# åˆ›å»ºè„šæœ¬ç›®å½•
mkdir -p scripts reports temp

# åˆ›å»ºåˆ†ç±»å›¾ç‰‡ç›®å½•
mkdir -p public/images/games/{math,science,coding,language,puzzle,sports,art,geography}
```

### é˜¶æ®µ2: æ•°æ®æ¸…ç†ï¼ˆåŠå¤©ï¼‰

1. **å¤‡ä»½ç°æœ‰æ•°æ®**
   ```bash
   npm run backup-data
   ```

2. **æ¸…ç†æ— ç”¨æ–‡ä»¶**
   ```bash
   npm run clean-files
   ```

3. **é‡æ„æ•°æ®ç»“æ„**
   ```bash
   npm run update-structure
   ```

### é˜¶æ®µ3: å·¥å…·å¼€å‘ï¼ˆ1-2å¤©ï¼‰

1. **å¼€å‘ä¸»çˆ¬è™«è„šæœ¬** (`scripts/game-scraper.js`)
2. **å¼€å‘å¹³å°é€‚é…å™¨** (CrazyGames, Miniplay, GameDistribution, Scratch)
3. **å¼€å‘æˆªå›¾åŠŸèƒ½** (Puppeteerè‡ªåŠ¨æˆªå›¾)
4. **å¼€å‘å›¾ç‰‡å¤„ç†** (Sharpä¼˜åŒ–)
5. **å¼€å‘æ‰¹é‡å¤„ç†** (æ”¯æŒæ¸¸æˆåˆ—è¡¨æ‰¹é‡å¤„ç†)

### é˜¶æ®µ4: æ•°æ®é‡‡é›†ï¼ˆ1-2å¤©ï¼‰

1. **å‡†å¤‡æ¸¸æˆåˆ—è¡¨** (åŸºäºç°æœ‰games.jsonå’Œæ–°éœ€æ±‚)
2. **åˆ†æ‰¹é‡‡é›†æ•°æ®** (æ¯æ‰¹20-30ä¸ªæ¸¸æˆï¼Œé¿å…è¿‡è½½)
3. **äººå·¥å®¡æ ¸å…³é”®å­—æ®µ** (åˆ†ç±»ã€éš¾åº¦ã€å¹´é¾„èŒƒå›´)
4. **æ•°æ®éªŒè¯å’Œä¿®å¤** (ç¡®ä¿æ‰€æœ‰å­—æ®µå®Œæ•´æœ‰æ•ˆ)

---

## ğŸ“Š è´¨é‡ä¿è¯å’ŒéªŒè¯

### æ•°æ®éªŒè¯è§„åˆ™

```javascript
// æ•°æ®å®Œæ•´æ€§éªŒè¯
function validateGameData(gameData) {
  const errors = [];
  
  // å¿…éœ€å­—æ®µæ£€æŸ¥
  const requiredFields = [
    'slug', 'title', 'category', 'categoryName', 
    'url', 'description', 'image', 'imageFallback',
    'difficulty', 'ageRange', 'minAge', 'maxAge',
    'developer', 'source', 'type'
  ];
  
  for (const field of requiredFields) {
    if (!gameData[field]) {
      errors.push(`ç¼ºå°‘å¿…éœ€å­—æ®µ: ${field}`);
    }
  }
  
  // å­—æ®µæ ¼å¼éªŒè¯
  if (gameData.slug && !/^[a-z0-9-]+$/.test(gameData.slug)) {
    errors.push('slugæ ¼å¼ä¸æ­£ç¡®');
  }
  
  if (gameData.url && !isValidUrl(gameData.url)) {
    errors.push('URLæ ¼å¼ä¸æ­£ç¡®');
  }
  
  if (gameData.ageRange && !/^\d+-\d+$/.test(gameData.ageRange)) {
    errors.push('å¹´é¾„èŒƒå›´æ ¼å¼ä¸æ­£ç¡®');
  }
  
  if (gameData.minAge && gameData.maxAge && gameData.minAge > gameData.maxAge) {
    errors.push('æœ€å°å¹´é¾„ä¸èƒ½å¤§äºæœ€å¤§å¹´é¾„');
  }
  
  // å›¾ç‰‡æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
  if (gameData.image && !fileExists(`public${gameData.image}`)) {
    errors.push('ä¸»å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨');
  }
  
  if (gameData.imageFallback && !fileExists(`public${gameData.imageFallback}`)) {
    errors.push('å¤‡ç”¨å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨');
  }
  
  return errors;
}
```

### å›¾ç‰‡è´¨é‡æ ‡å‡†

```javascript
// å›¾ç‰‡è´¨é‡æ£€æŸ¥
async function validateImageQuality(imagePath) {
  try {
    const metadata = await sharp(imagePath).metadata();
    
    const issues = [];
    
    // å°ºå¯¸æ£€æŸ¥
    if (metadata.width !== 400 || metadata.height !== 300) {
      issues.push(`å°ºå¯¸ä¸æ ‡å‡†: ${metadata.width}x${metadata.height}, åº”ä¸º400x300`);
    }
    
    // æ–‡ä»¶å¤§å°æ£€æŸ¥
    const stats = await fs.stat(imagePath);
    if (stats.size > 100 * 1024) { // 100KB
      issues.push(`æ–‡ä»¶è¿‡å¤§: ${Math.round(stats.size / 1024)}KB, åº”å°äº100KB`);
    }
    
    // æ ¼å¼æ£€æŸ¥
    if (!['webp', 'jpeg'].includes(metadata.format)) {
      issues.push(`æ ¼å¼ä¸æ”¯æŒ: ${metadata.format}, åº”ä¸ºwebpæˆ–jpeg`);
    }
    
    return issues;
  } catch (error) {
    return [`å›¾ç‰‡è¯»å–å¤±è´¥: ${error.message}`];
  }
}
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœå’Œæˆæœ

### è‡ªåŠ¨åŒ–ç¨‹åº¦é¢„æœŸ

| ä»»åŠ¡ç±»å‹ | è‡ªåŠ¨åŒ–æ¯”ä¾‹ | äººå·¥å·¥ä½œé‡ | æ—¶é—´èŠ‚çœ |
|----------|------------|------------|----------|
| åŸºæœ¬ä¿¡æ¯è·å– | 90% | 10% | èŠ‚çœ80%æ—¶é—´ |
| å›¾ç‰‡è·å–å¤„ç† | 95% | 5% | èŠ‚çœ90%æ—¶é—´ |
| æ•°æ®éªŒè¯æ¸…ç† | 70% | 30% | èŠ‚çœ60%æ—¶é—´ |
| æ•´ä½“æ•°æ®å½•å…¥ | 85% | 15% | èŠ‚çœ75%æ—¶é—´ |

### æœ€ç»ˆäº¤ä»˜æˆæœ

1. **å®Œæ•´çš„æ¸¸æˆæ•°æ®åº“**
   - ç¬¦åˆæœ€æ–°æ•°æ®åº“å­—æ®µè®¾è®¡
   - åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
   - æ•°æ®æ ¼å¼ç»Ÿä¸€æ ‡å‡†

2. **é«˜è´¨é‡æ¸¸æˆæˆªå›¾**
   - ç»Ÿä¸€400x300å°ºå¯¸
   - WebPä¸»æ ¼å¼ + JPGå¤‡ç”¨æ ¼å¼
   - æŒ‰åˆ†ç±»ç»„ç»‡å­˜å‚¨

3. **æ¸…ç†çš„æ–‡ä»¶ç»“æ„**
   - ç§»é™¤æ‰€æœ‰å†—ä½™æ–‡ä»¶
   - æŒ‰åˆ†ç±»ç»„ç»‡å›¾ç‰‡
   - ä¼˜åŒ–å­˜å‚¨ç©ºé—´

4. **å¯é‡ç”¨çš„è‡ªåŠ¨åŒ–å·¥å…·**
   - æ”¯æŒå¤šå¹³å°æ¸¸æˆé‡‡é›†
   - æ™ºèƒ½æˆªå›¾å’Œå›¾ç‰‡å¤„ç†
   - æ‰¹é‡å¤„ç†å’Œé”™è¯¯æ¢å¤

5. **è¯¦ç»†çš„å¤„ç†æŠ¥å‘Š**
   - æˆåŠŸç‡ç»Ÿè®¡
   - é”™è¯¯é—®é¢˜è®°å½•
   - æ”¹è¿›å»ºè®®

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å¤‡ä»½ç°æœ‰æ•°æ®
npm run backup-data

# 3. æ¸…ç†æ–‡ä»¶ç»“æ„
npm run clean-files

# 4. è¿è¡Œè‡ªåŠ¨åŒ–é‡‡é›†
npm run scrape-games

# 5. éªŒè¯æ•°æ®è´¨é‡
npm run validate-data
```

### é…ç½®æ¸¸æˆåˆ—è¡¨

åœ¨ `scripts/game-list.json` ä¸­é…ç½®è¦é‡‡é›†çš„æ¸¸æˆï¼š

```json
[
  {
    "url": "https://www.crazygames.com/embed/2048",
    "category": "math",
    "title": "2048"
  },
  {
    "url": "https://www.miniplay.com/embed/math-duck", 
    "category": "math",
    "title": "Math Duck"
  }
]
```

### è‡ªå®šä¹‰é‡‡é›†è§„åˆ™

å¯ä»¥åœ¨ `scripts/game-scraper.js` ä¸­è‡ªå®šä¹‰ï¼š

- å¹³å°ç‰¹å®šçš„æ•°æ®æå–è§„åˆ™
- æˆªå›¾ç­–ç•¥å’Œå‚æ•°
- å›¾ç‰‡å¤„ç†è´¨é‡è®¾ç½®
- é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘

---

## ğŸ¯ æ€»ç»“

é€šè¿‡è¿™ä¸ªè‡ªåŠ¨åŒ–é‡‡é›†ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **å¤§å¹…æé«˜æ•ˆç‡** - 85%çš„å·¥ä½œè‡ªåŠ¨åŒ–å®Œæˆ
2. **ç¡®ä¿æ•°æ®è´¨é‡** - ç»Ÿä¸€çš„æ ¼å¼å’ŒéªŒè¯æ ‡å‡†
3. **ä¼˜åŒ–æ–‡ä»¶ç»“æ„** - æ¸…ç†å†—ä½™ï¼ŒæŒ‰åˆ†ç±»ç»„ç»‡
4. **æ”¯æŒæ‰¹é‡å¤„ç†** - ä¸€æ¬¡æ€§å¤„ç†å¤§é‡æ¸¸æˆ
5. **ä¾¿äºç»´æŠ¤æ‰©å±•** - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°å¹³å°

è¿™ä¸ªç³»ç»Ÿå°†å¸®åŠ©ä½ å¿«é€Ÿã€é«˜è´¨é‡åœ°å®Œæˆæ¸¸æˆæ•°æ®çš„å½•å…¥å’Œç®¡ç†å·¥ä½œï¼Œä¸ºEduGameHQå¹³å°æä¾›ä¸°å¯Œã€å‡†ç¡®çš„æ¸¸æˆèµ„æºã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024å¹´12æœˆ  
**é€‚ç”¨é¡¹ç›®**: EduGameHQ.com  
**æŠ€æœ¯æ ˆ**: Astro 5.0 + React 19 + TypeScript 