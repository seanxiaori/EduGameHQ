# 🤖 自动游戏发现系统使用指南

## 📋 目录

1. [系统概述](#系统概述)
2. [工作原理](#工作原理)
3. [如何使用](#如何使用)
4. [配置说明](#配置说明)
5. [常见问题](#常见问题)
6. [故障排除](#故障排除)

---

## 系统概述

自动游戏发现系统是一个完全免费的自动化工具，帮助你从各大教育游戏网站发现优质新游戏。

### ✨ 核心特性

- ✅ **零成本** - 完全使用GitHub免费资源
- ✅ **零运维** - 自动定时运行，无需人工干预
- ✅ **智能筛选** - 基于规则的质量评估系统
- ✅ **自动去重** - 避免重复收录游戏
- ✅ **PR审核** - 可视化审核界面，一键批准

### 🎯 解决的问题

❌ **之前**: 手动搜索游戏 → 手动测试 → 手动添加到JSON → 费时费力

✅ **现在**: 系统自动发现 → 自动评估 → 生成PR → 你只需点击批准 → 自动上线

---

## 工作原理

```
┌─────────────────────────────────────────┐
│  GitHub Actions (每天10:00自动运行)      │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  智能爬虫                                │
│  - CrazyGames                           │
│  - Cool Math Games                      │
│  - 其他可配置网站                         │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  质量评估 (100分制)                       │
│  - 来源评分 (30分)                       │
│  - 热度评分 (25分)                       │
│  - 技术评分 (20分)                       │
│  - 安全评分 (15分)                       │
│  - 新鲜度 (10分)                         │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  去重检测                                │
│  - URL匹配                              │
│  - 标题相似度                            │
│  - Slug冲突                             │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  自动创建PR                              │
│  - 游戏预览卡片                          │
│  - 评分详情                              │
│  - 一键测试链接                          │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│  你审核PR                                │
│  ✅ Merge → 自动部署                     │
│  ❌ Close → 拒绝                         │
└─────────────────────────────────────────┘
```

---

## 如何使用

### 📧 接收通知

系统运行后，如果发现新游戏，你会收到GitHub邮件通知：

```
📬 [EduGameHQ] New Pull Request: 🎮 自动发现 5 个新教育游戏
```

### 👀 查看PR

1. 点击邮件中的链接，或访问项目的Pull Requests页面
2. 你会看到详细的游戏列表，包括：
   - 游戏标题、描述
   - 预览图
   - 评分详情
   - 测试链接

### 🎮 测试游戏

点击每个游戏的"试玩链接"，在浏览器中测试：
- 游戏是否能正常加载
- 是否适合目标年龄段
- 教育价值如何
- 是否有不当内容

### ✅ 审核操作

#### 方式1：全部批准

如果所有游戏都满意，直接点击 **Merge pull request** 按钮即可。

#### 方式2：部分批准

1. 点击 **Files changed** 标签
2. 找到 `src/data/games.json` 文件
3. 点击右上角的 **编辑** (铅笔图标)
4. 删除不想要的游戏条目
5. 点击 **Commit changes**
6. 返回 **Conversation** 标签
7. 点击 **Merge pull request**

#### 方式3：全部拒绝

如果都不满意，点击 **Close pull request** 按钮。

### 🚀 自动部署

PR合并后，Cloudflare Pages会自动：
1. 检测到代码变更
2. 重新构建网站
3. 部署到生产环境
4. 通常2-3分钟内完成

---

## 配置说明

### 📁 配置文件位置

`scripts/game-sources-config.json`

### 🔧 主要配置项

#### 1. 游戏来源

```json
{
  "sources": {
    "crazygames": {
      "enabled": true,      // 是否启用
      "priority": 1,        // 优先级（数字越小优先级越高）
      "limits": {
        "gamesPerCategory": 20,  // 每个分类爬取数量
        "maxPages": 3            // 最多爬取页数
      }
    }
  }
}
```

**如何添加新来源**：
1. 在 `sources` 中添加新的配置对象
2. 在 `scripts/intelligent-game-crawler.mjs` 中实现对应的爬虫函数

#### 2. 筛选规则

```json
{
  "filters": {
    "minScore": 70,          // 最低综合评分
    "maxGamesPerRun": 10,    // 每次最多发现游戏数
    "requireIframe": true,   // 是否必须支持iframe
    "requireMobile": false,  // 是否必须支持移动端
    "minRating": 3.5,        // 最低来源评分
    "minPlayCount": 5000     // 最低播放次数
  }
}
```

**调整建议**：
- `minScore`: 提高可获得更高质量游戏，但数量会减少
- `maxGamesPerRun`: 建议保持在5-15个，避免PR过长
- `minRating`: 3.5是较好的平衡点

#### 3. 内容安全

```json
{
  "blacklist": [
    "casino",
    "gambling",
    "violence",
    "gore",
    // ... 更多敏感词
  ]
}
```

**如何添加黑名单词**：
直接在数组中添加新词汇即可，系统会自动过滤包含这些词的游戏。

#### 4. 运行时间

编辑 `.github/workflows/auto-discover-games.yml`:

```yaml
on:
  schedule:
    - cron: '0 2 * * *'  # UTC 2:00 = 北京时间 10:00
```

**Cron格式说明**：
```
* * * * *
│ │ │ │ │
│ │ │ │ └─ 星期几 (0-7, 0和7都代表周日)
│ │ │ └─── 月份 (1-12)
│ │ └───── 日期 (1-31)
│ └─────── 小时 (0-23)
└───────── 分钟 (0-59)
```

**常用示例**：
- `0 2 * * *` - 每天2:00
- `0 2 * * 1` - 每周一2:00
- `0 2 1 * *` - 每月1号2:00
- `0 */6 * * *` - 每6小时一次

---

## 常见问题

### ❓ 系统会自动运行吗？

是的，每天北京时间10:00自动运行。你也可以手动触发：
1. 进入项目的 **Actions** 标签
2. 选择 "🎮 自动发现教育游戏"
3. 点击 **Run workflow**

### ❓ 如果没有发现新游戏会怎样？

系统会静默结束，不会创建PR，也不会发送通知。

### ❓ 如何查看运行日志？

1. 进入项目的 **Actions** 标签
2. 点击最近的运行记录
3. 查看详细日志

### ❓ 系统会重复发现同一个游戏吗？

不会。系统有三重去重机制：
1. URL完全匹配检测
2. 标题相似度计算
3. Slug冲突检测

### ❓ 可以暂停自动运行吗？

可以，编辑 `.github/workflows/auto-discover-games.yml`，注释掉 `schedule` 部分：

```yaml
# on:
#   schedule:
#     - cron: '0 2 * * *'
on:
  workflow_dispatch:  # 只保留手动触发
```

### ❓ 如何提高发现的游戏质量？

调整 `scripts/game-sources-config.json` 中的筛选条件：
- 提高 `minScore` (例如从70改为80)
- 提高 `minRating` (例如从3.5改为4.0)
- 提高 `minPlayCount` (例如从5000改为10000)

---

## 故障排除

### 🔧 GitHub Actions运行失败

**可能原因**：
1. 依赖安装失败
2. 网络问题
3. 代码错误

**解决方法**：
1. 查看Actions日志定位具体错误
2. 检查 `package.json` 依赖是否正确
3. 尝试手动运行看是否能复现

### 🔧 未收到PR通知

**可能原因**：
1. GitHub通知设置问题
2. 邮件被过滤
3. 确实没有发现新游戏

**解决方法**：
1. 检查GitHub通知设置
2. 查看Actions历史记录确认是否运行
3. 查看日志确认是否发现游戏

### 🔧 PR创建失败

**可能原因**：
1. 权限不足
2. 分支冲突
3. JSON格式错误

**解决方法**：
1. 确保 `GITHUB_TOKEN` 有足够权限
2. 手动解决冲突
3. 检查生成的JSON是否有语法错误

### 🔧 游戏数据不完整

**可能原因**：
1. 爬虫逻辑需要更新（网站改版）
2. 网络超时
3. 数据标准化问题

**解决方法**：
1. 更新对应网站的爬虫代码
2. 增加重试次数和超时时间
3. 检查 `normalizeGameData` 函数

---

## 🛠️ 高级定制

### 添加新的游戏来源网站

1. 在 `scripts/game-sources-config.json` 添加配置
2. 在 `scripts/intelligent-game-crawler.mjs` 中实现爬虫函数
3. 测试爬虫是否正常工作

示例：

```javascript
async function crawlNewWebsite(categoryConfig) {
  console.log('🕷️ 爬取 NewWebsite...');
  
  // 实现爬虫逻辑
  const games = [];
  
  // ... 爬取代码 ...
  
  return games;
}

// 在main函数中添加调用
if (sourceName === 'newwebsite') {
  sourceGames = await crawlNewWebsite(sourceConfig);
}
```

### 调整评分算法

编辑 `scripts/game-evaluator.mjs` 中的评分函数，可以：
- 修改各维度的权重
- 添加新的评分维度
- 调整评分公式

### 自定义PR模板

编辑 `.github/pull_request_template.md` 自定义PR的显示内容。

---

## 📞 获取帮助

如果遇到问题：

1. 查看 [GitHub Issues](https://github.com/edugamehq/edugamehq/issues)
2. 查看Actions运行日志
3. 创建新Issue描述问题

---

## 🎉 最佳实践

1. **定期审核**: 建议每天查看PR，保持新鲜度
2. **质量优先**: 宁缺毋滥，确保每个游戏都有教育价值
3. **用户反馈**: 关注用户数据，下线低质量游戏
4. **配置优化**: 根据实际情况调整筛选规则
5. **来源多样化**: 添加更多优质游戏网站作为来源

---

**祝使用愉快！🎮**

