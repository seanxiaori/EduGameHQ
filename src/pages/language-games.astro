---
import BaseLayout from '../layouts/BaseLayout.astro';
import type { Game, GameData } from '../types/game';
import fs from 'fs';
import path from 'path';

const seoData = {
  title: "Language Games for Kids | Free Online Learning Games | EduGameHQ",
  description: "Play 12+ free language games for kids aged 6-18. Improve your language skills with interactive vocabulary, grammar, and communication games.",
  keywords: ["language games", "arithmetic games", "algebra games", "geometry games", "math for kids", "educational language games", "free language games"],
  ogImage: "/images/language-games-og.jpg"
};

// 从JSON文件读取游戏数据
const gamesDataPath = path.join(process.cwd(), 'src/data/games/games.json');
let allGamesData: GameData = {};

try {
  const fileContent = fs.readFileSync(gamesDataPath, 'utf-8');
  allGamesData = JSON.parse(fileContent) as GameData;
} catch (error) {
  console.warn('Unable to read games data file');
}

// 筛选语言游戏并添加真实图片
const mathGames = Object.entries(allGamesData)
  .filter(([_id, game]: [string, Game]) => game.category === 'language')
  .map(([id, game]: [string, Game]) => ({
    id: id,
    title: game.title,
    description: game.description,
    icon: 'fas fa-language',
    // 使用爬取的真实游戏截图
    image: game.screenshots && game.screenshots.length > 0 
      ? `/images/games/details/${game.screenshots[0]}` 
      : `/images/games/${id}.svg`,
    difficulty: game.difficulty,
    age: `Ages ${game.ageRange}`,
    skills: game.tags && game.tags.length > 0 ? game.tags : ['Language', 'Problem Solving'],
    url: `/games/${id}`,
    playCount: game.playCount || 0,
    featured: ['2048', 'make-ten', 'factor-crafter', 'math-duck'].includes(id)
  }));

// 按难度分组
const gamesByDifficulty = {
  'Easy': mathGames.filter(game => game.difficulty === 'Easy'),
  'Medium': mathGames.filter(game => game.difficulty === 'Medium'),
  'Hard': mathGames.filter(game => game.difficulty === 'Hard')
};
---

<BaseLayout title={seoData.title} description={seoData.description}>
  <main class="main-content">
    <div class="content-wrapper">
      <!-- 页面标题 -->
      <header class="page-header">
        <div class="header-content">
          <div class="header-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <div class="header-text">
            <h1 class="page-title">Language Games</h1>
            <p class="page-subtitle">
              Improve reading, writing, vocabulary, and communication skills with our engaging language games designed for English learners worldwide.
            </p>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-number">{languageGames.length}</span>
            <span class="stat-label">Games</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">6-18</span>
            <span class="stat-label">Ages</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">Free</span>
            <span class="stat-label">Cost</span>
          </div>
        </div>
      </header>

      <div class="page-layout">
        <!-- 主要内容区域 -->
        <div class="main-section">
          <!-- 特色游戏 -->
          <section class="featured-games">
            <h2 class="section-title">
              <div class="section-icon featured">
                <i class="fas fa-star"></i>
              </div>
              Featured Language Games
            </h2>
            <div class="games-grid">
              {mathGames.filter(game => game.featured).map(game => (
                <a href={game.url} class="game-card featured">
                  <div class="game-thumbnail">
                    <img src={game.image} alt={game.title} class="game-image" loading="lazy" />
                    <div class="featured-badge">FEATURED</div>
                    <div class="play-overlay">
                      <div class="play-btn">
                        <i class="fas fa-play"></i> Play Now
                      </div>
                    </div>
                  </div>
                  <div class="game-info">
                    <h3 class="game-title">{game.title}</h3>
                    <p class="game-description">{game.description}</p>
                    <div class="game-meta">
                      <div class="game-tags">
                        <span class="game-tag age">{game.age}</span>
                        <span class={`game-tag difficulty ${game.difficulty.toLowerCase()}`}>{game.difficulty}</span>
                      </div>
                      <div class="game-stats">
                        <div class="stat">
                          <i class="fas fa-play"></i>
                          <span>{(game.playCount || 0).toLocaleString()}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </section>

          <!-- 按难度分组的游戏 -->
          {Object.entries(gamesByDifficulty).map(([difficulty, games]) => (
            games.length > 0 && (
              <section class="difficulty-section">
                <h2 class="section-title">
                  <div class={`section-icon difficulty-${difficulty.toLowerCase()}`}>
                    {difficulty === 'Easy' && <i class="fas fa-smile"></i>}
                    {difficulty === 'Medium' && <i class="fas fa-meh"></i>}
                    {difficulty === 'Hard' && <i class="fas fa-frown"></i>}
                  </div>
                  {difficulty} Level Games
                </h2>
                <div class="games-grid">
                  {games.map(game => (
                    <a href={game.url} class="game-card">
                      <div class="game-thumbnail">
                        <img src={game.image} alt={game.title} class="game-image" loading="lazy" />
                        <div class="play-overlay">
                          <div class="play-btn">
                            <i class="fas fa-play"></i> Play Now
                          </div>
                        </div>
                      </div>
                      <div class="game-info">
                        <h3 class="game-title">{game.title}</h3>
                        <p class="game-description">{game.description}</p>
                        <div class="game-meta">
                          <div class="game-tags">
                            <span class="game-tag age">{game.age}</span>
                            <span class={`game-tag difficulty ${difficulty.toLowerCase()}`}>{difficulty}</span>
                          </div>
                          <div class="game-stats">
                            <div class="stat">
                              <i class="fas fa-play"></i>
                              <span>{(game.playCount || 0).toLocaleString()}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </a>
                  ))}
                </div>
              </section>
            )
          ))}
        </div>

        <!-- 侧边栏 -->
        <aside class="sidebar">
          <!-- 学习提示 -->
          <div class="sidebar-card">
            <h3 class="sidebar-title">
              <div class="sidebar-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              Language Learning Tips
            </h3>
            <ul class="tips-list">
              <li>Read regularly to expand vocabulary</li>
              <li>Practice speaking and writing daily</li>
              <li>Use context clues to understand new words</li>
              <li>Play word games to make learning fun</li>
              <li>Listen to stories and audiobooks</li>
            </ul>
          </div>

          <!-- 语言技能 -->
          <div class="sidebar-card">
            <h3 class="sidebar-title">
              <div class="sidebar-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              Skills You'll Develop
            </h3>
            <div class="skills-list">
              <span class="skill-tag">Reading Comprehension</span>
              <span class="skill-tag">Vocabulary Building</span>
              <span class="skill-tag">Grammar & Syntax</span>
              <span class="skill-tag">Writing Skills</span>
              <span class="skill-tag">Spelling</span>
              <span class="skill-tag">Communication</span>
              <span class="skill-tag">Critical Thinking</span>
              <span class="skill-tag">Creative Expression</span>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>
</BaseLayout>

<style>
  /* 主要内容区域 */
  .main-content {
    width: 100%;
    background: #FEFCFB;
    min-height: 100vh;
  }

  .content-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* 页面布局 */
  .page-layout {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 3rem;
    margin-bottom: 3rem;
  }

  .main-section {
    min-width: 0;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  
  

  

  

  

  /* 页面头部 */
  .page-header {
    background: linear-gradient(135deg, #FFF7ED 0%, rgba(234, 88, 12, 0.1) 100%);
    border-radius: 20px;
    padding: 3rem 2rem;
    text-align: center;
    margin-bottom: 3rem;
    border: 1px solid rgba(234, 88, 12, 0.2);
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(234, 88, 12, 0.05) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
  }

  .header-content {
    max-width: 600px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }

  /* 统一的分类图标系统 */
  .category-icon {
    width: 100px;
    height: 100px;
    margin: 0 auto 2rem;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .icon-background {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: white;
    position: relative;
    z-index: 2;
    box-shadow: 
      0 10px 25px rgba(0, 0, 0, 0.15),
      0 4px 10px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }

  .icon-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    opacity: 0.3;
    animation: pulse 2s ease-in-out infinite;
  }

  /* 数学分类图标 */
  .category-icon.math .icon-background {
    background: linear-gradient(135deg, #C026D3 0%, #DC2626 100%);
  }

  .category-icon.math .icon-glow {
    background: radial-gradient(circle, #C026D3 0%, transparent 70%);
  }

  /* 科学分类图标 */
  .category-icon.science .icon-background {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
  }

  .category-icon.science .icon-glow {
    background: radial-gradient(circle, #059669 0%, transparent 70%);
  }

  /* 编程分类图标 */
  .category-icon.coding .icon-background {
    background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
  }

  .category-icon.coding .icon-glow {
    background: radial-gradient(circle, #2563EB 0%, transparent 70%);
  }

  /* 语言分类图标 */
  .category-icon.language .icon-background {
    background: linear-gradient(135deg, #C026D3 0%, #A21CAF 100%);
  }

  .category-icon.language .icon-glow {
    background: radial-gradient(circle, #C026D3 0%, transparent 70%);
  }

  /* 益智分类图标 */
  .category-icon.puzzle .icon-background {
    background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
  }

  .category-icon.puzzle .icon-glow {
    background: radial-gradient(circle, #7C3AED 0%, transparent 70%);
  }

  .page-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 3rem;
    font-weight: 800;
    margin-bottom: 1rem;
    color: #C026D3;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .page-description {
    font-size: 1.125rem;
    color: #6B7280;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .page-stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
  }

  .stat-item {
    text-align: center;
  }

  .stat-number {
    display: block;
    font-size: 1.5rem;
    font-weight: 800;
    color: #C026D3;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #6B7280;
    font-weight: 500;
  }

  /* 统一的区域标题图标系统 */
  .section-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: #1F2937;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .section-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
  }

  .section-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
  }

  .section-icon.featured {
    background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
  }

  .section-icon.difficulty-easy {
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
  }

  .section-icon.difficulty-medium {
    background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
  }

  .section-icon.difficulty-hard {
    background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
  }

  /* 侧边栏图标 */
  .sidebar-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: #1F2937;
    margin-bottom: 1rem;
  }

  .sidebar-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: linear-gradient(135deg, #C026D3 0%, #DC2626 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(234, 88, 12, 0.3);
  }

  /* 游戏网格 */
  .games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .game-card {
    background: white;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid #E5E7EB;
    text-decoration: none;
    color: inherit;
  }

  .game-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    text-decoration: none;
    color: inherit;
  }

  .game-card.featured {
    border: 2px solid #C026D3;
    box-shadow: 0 4px 15px rgba(234, 88, 12, 0.2);
  }

  .game-thumbnail {
    height: 200px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
  }

  .game-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    transition: transform 0.3s ease;
  }

  .game-card:hover .game-image {
    transform: scale(1.05);
  }

  .featured-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #C026D3;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    z-index: 2;
  }

  .play-overlay {
    position: absolute;
    inset: 0;
    background: rgba(234, 88, 12, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .game-card:hover .play-overlay {
    opacity: 1;
  }

  .play-btn {
    background: white;
    color: #C026D3;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .play-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .game-info {
    padding: 1.5rem;
  }

  .game-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1F2937;
    margin-bottom: 0.5rem;
  }

  .game-description {
    color: #6B7280;
    line-height: 1.5;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .game-meta {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .game-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .game-tag {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .game-tag.age {
    background: #F3F4F6;
    color: #6B7280;
  }

  .game-tag.difficulty.easy {
    background: #10B981;
    color: white;
  }

  .game-tag.difficulty.medium {
    background: #F59E0B;
    color: white;
  }

  .game-tag.difficulty.hard {
    background: #EF4444;
    color: white;
  }

  .game-stats {
    display: flex;
    gap: 1rem;
  }

  .stat {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.8rem;
    color: #6B7280;
  }

  .stat i {
    color: #F59E0B;
  }

  /* 侧边栏样式 */
  .sidebar-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .tips-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .tips-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #F3F4F6;
    color: #6B7280;
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .tips-list li:last-child {
    border-bottom: none;
  }

  .skills-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .skill-tag {
    background: rgba(234, 88, 12, 0.1);
    color: #C026D3;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  /* 动画效果 */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  @keyframes pulse {
    0%, 100% { 
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.3;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.1);
      opacity: 0.5;
    }
  }

  /* 响应式设计 */
  @media (max-width: 1024px) {
    .page-layout {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .games-grid {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .content-wrapper {
      padding: 1rem;
    }

    .page-header {
      padding: 2rem 1rem;
    }

    .category-icon {
      width: 80px;
      height: 80px;
    }

    .icon-background {
      width: 60px;
      height: 60px;
      font-size: 2rem;
    }

    .icon-glow {
      width: 80px;
      height: 80px;
    }

    .page-title {
      font-size: 2rem;
    }

    .page-stats {
      flex-direction: column;
      gap: 1rem;
    }

    .games-grid {
      grid-template-columns: 1fr;
    }

    .section-title {
      font-size: 1.5rem;
    }

    .section-icon {
      width: 40px;
      height: 40px;
      font-size: 1rem;
    }
  }
</style> 

