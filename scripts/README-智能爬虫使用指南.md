# 智能游戏爬虫使用指南

## 🎯 功能概述

智能游戏爬虫系统专门用于爬取教育游戏的详细信息，包括：

- 🖼️ **游戏介绍图片** - 从游戏页面提取官方介绍图片
- 📸 **智能截图** - 自动截取游戏加载、开始、游戏中等不同状态的截图
- 📝 **游戏详细信息** - 提取游戏名称、描述、标签、评分等
- 🎮 **操作说明** - 自动提取控制方式、游戏规则、目标等
- 📄 **生成Astro页面** - 自动生成符合项目规范的游戏详情页

## 🚀 快速开始

### 1. 运行智能爬虫

```bash
# 方法1: 使用npm脚本（推荐）
npm run crawl-games

# 方法2: 直接运行
node scripts/run-intelligent-crawler.js
```

### 2. 查看爬取结果

爬取完成后，您可以在以下位置找到结果：

- **游戏详情数据**: `public/images/games/details/`
- **游戏截图**: `public/images/games/details/`
- **Astro页面**: `src/pages/games/`

### 3. 访问生成的页面

启动开发服务器后，可以访问：

```bash
npm run dev
```

然后访问：`http://localhost:4321/games/[游戏ID]`

## 📋 支持的游戏列表

当前配置支持以下游戏：

### 数学游戏
- **Math Duck** - 数学鸭子练习游戏
- **2048** - 经典数字合并游戏  
- **Make Ten** - 数字组合游戏

### 科学游戏
- **Little Alchemy 2** - 元素合成游戏
- **Grid Construction** - 电网建设游戏
- **Conway's Game of Life** - 生命游戏

### 编程游戏
- **Learn GDScript** - 编程学习游戏
- **Lightbot** - 编程逻辑游戏

## 🔧 配置说明

### 添加新游戏

在 `scripts/intelligent-game-crawler.js` 中的 `GAMES_CONFIG` 对象添加新游戏：

```javascript
'new-game-id': {
  name: '游戏名称',
  url: '游戏页面URL',
  embedUrl: '游戏嵌入URL',
  category: 'math|science|coding|language|puzzle',
  source: '游戏来源',
  ageRange: '适合年龄',
  difficulty: 'Easy|Medium|Hard'
}
```

### 自定义爬取规则

可以在以下方法中自定义爬取规则：

- `extractGameInfo()` - 游戏信息提取
- `extractGameImages()` - 游戏图片提取
- `extractDetailedInstructions()` - 操作说明提取

## 📸 截图功能

### 智能截图策略

1. **主截图** - 游戏页面加载完成后的截图
2. **游戏截图** - 点击开始按钮后的截图
3. **操作截图** - 模拟游戏操作后的截图

### 截图优化

- 自动等待游戏加载完成
- 智能识别开始按钮并点击
- 模拟常见游戏操作（空格、方向键、鼠标点击）
- 高质量JPEG格式，90%压缩率

## 🎨 页面生成

### Astro页面特性

生成的游戏详情页包含：

- ✅ **SEO优化** - 完整的meta标签和结构化数据
- ✅ **响应式设计** - 适配所有设备
- ✅ **游戏播放器** - iframe嵌入游戏
- ✅ **截图展示** - 带灯箱效果的截图画廊
- ✅ **学习目标** - 教育价值展示
- ✅ **操作说明** - 详细的游戏指南
- ✅ **相关推荐** - 同类游戏推荐

### 页面结构

```
游戏详情页
├── 游戏头部信息
├── 游戏播放器（iframe）
├── 游戏截图展示
├── 学习目标卡片
├── 操作说明
└── 相关游戏推荐
```

## 🛠️ 技术细节

### 依赖项

- **Puppeteer** - 浏览器自动化
- **Sharp** - 图片处理（可选）
- **Node.js** - 运行环境

### 爬取流程

1. **初始化浏览器** - 启动Puppeteer
2. **访问游戏页面** - 加载游戏URL
3. **等待页面加载** - 确保内容完全加载
4. **提取游戏信息** - 使用CSS选择器提取数据
5. **下载游戏图片** - 保存介绍图片
6. **智能截图** - 多状态截图
7. **提取操作说明** - 自动识别说明文本
8. **生成Astro页面** - 使用模板生成页面
9. **保存数据** - 保存JSON数据文件

### 错误处理

- 网络超时处理
- 页面加载失败处理
- 图片下载失败处理
- 选择器未找到处理

## 📊 输出文件说明

### JSON数据文件

```json
{
  "id": "game-id",
  "name": "游戏名称",
  "category": "游戏分类",
  "info": {
    "title": "游戏标题",
    "description": "游戏描述",
    "tags": ["标签1", "标签2"],
    "rating": "评分",
    "features": ["特色1", "特色2"]
  },
  "images": ["intro-1.jpg", "intro-2.jpg"],
  "screenshots": ["main.jpg", "gameplay.jpg"],
  "instructions": {
    "controls": ["控制方式"],
    "howToPlay": "游戏玩法",
    "objectives": ["游戏目标"],
    "rules": ["游戏规则"]
  }
}
```

### 图片文件

- `{gameId}-main.jpg` - 主截图
- `{gameId}-gameplay.jpg` - 游戏截图
- `{gameId}-action.jpg` - 操作截图
- `{gameId}-intro-{n}.jpg` - 介绍图片

## 🔍 调试和故障排除

### 常见问题

1. **爬虫无法启动**
   - 检查Node.js版本（需要>=18.14.1）
   - 确保已安装puppeteer依赖

2. **页面加载失败**
   - 检查网络连接
   - 确认游戏URL是否有效
   - 增加超时时间

3. **截图失败**
   - 检查输出目录权限
   - 确保有足够的磁盘空间

4. **信息提取不完整**
   - 检查CSS选择器是否正确
   - 游戏页面结构可能已变化

### 调试模式

爬虫默认以可视化模式运行，您可以：

- 观察浏览器操作过程
- 查看页面加载情况
- 监控错误信息

### 日志输出

爬虫会输出详细的日志信息：

```
🚀 启动智能游戏爬虫...
🌐 正在加载游戏页面...
📝 提取游戏基本信息...
🖼️ 提取游戏介绍图片...
📸 智能截取游戏截图...
📖 提取详细操作说明...
📄 生成Astro游戏详情页...
✅ 游戏处理完成
```

## 📈 性能优化

### 爬取速度

- 每个游戏间隔3秒，避免请求过快
- 并发处理图片下载
- 智能跳过已存在的文件

### 资源使用

- 自动关闭浏览器页面
- 及时释放内存
- 压缩图片减少存储空间

## 🔄 更新和维护

### 定期更新

建议定期运行爬虫以：

- 获取最新的游戏信息
- 更新游戏截图
- 检查链接有效性

### 配置维护

- 定期检查游戏URL有效性
- 更新CSS选择器（如页面结构变化）
- 添加新的游戏源

## 📞 技术支持

如果遇到问题，请：

1. 查看控制台错误信息
2. 检查网络连接
3. 确认游戏URL有效性
4. 查看生成的日志文件

---

**注意**: 请遵守各游戏网站的robots.txt和使用条款，合理使用爬虫功能。 